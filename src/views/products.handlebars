<h1>Lista de Productos</h1>

<ul id="product-list">
  {{#each products}}
    <li>
      {{this.title}} - ${{this.price}} 
      <a href="/api/products/detalleproduct/{{this._id}}">
        <button>Ver</button>
      </a>

      {{#if ../user}} 
        <button onclick="modificarCarrito('{{this._id}}', 'agregar')">Agregar al carrito</button>
      {{else}}
        <a href="/api/users/login">Ingrese con su usuario</a>
      {{/if}}
    </li>
  {{/each}}
</ul>

<div class="pagination">
  {{#if hasPrevPage}}
    <a href="/api/products/?page={{prevPage}}"><button>Anterior</button></a>
  {{/if}}

  <span>Página {{currentPage}} de {{totalPages}}</span>

  {{#if hasNextPage}}
    <a href="/api/products/?page={{nextPage}}"><button>Siguiente</button></a>
  {{/if}}
</div>

<script>
  const list = document.getElementById('product-list');

  // Función para actualizar el carrito
  function modificarCarrito(productId, accion) {
    let method = 'POST';
    let url = `/api/carts/${accion}/${productId}`;
    if (accion === 'eliminar') method = 'DELETE';

    fetch(url, { method })
      .then(res => {
        if (res.ok) alert('Producto agregado al carrito');
        else alert('Error al modificar el carrito');
      });
  }

  // Función opcional para refrescar la página cuando se necesite
{{!--   function refrescarLista() {
    window.location.reload();
  } --}}

  // Opcional: Si necesitas actualizaciones periódicas
  // setInterval(refrescarLista, 30000); // Refresca cada 30 segundos
</script>